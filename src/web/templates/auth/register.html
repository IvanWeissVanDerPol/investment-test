{% extends "layouts/base.html" %}

{% block title %}Register - InvestmentAI{% endblock %}

{% block content %}
<div class="container-fluid vh-100">
    <div class="row h-100">
        <!-- Left side - Registration form -->
        <div class="col-md-6 d-flex align-items-center justify-content-center bg-light">
            <div class="card shadow-lg" style="width: 450px;">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <h2 class="h3 mb-3 font-weight-normal">Create Account</h2>
                        <p class="text-muted">Join InvestmentAI today</p>
                    </div>

                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form method="POST" action="{{ url_for('register') }}" id="registerForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="first_name" class="form-label">First Name</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="first_name" 
                                       name="first_name"
                                       placeholder="John">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="last_name" class="form-label">Last Name</label>
                                <input type="text" 
                                       class="form-control" 
                                       id="last_name" 
                                       name="last_name"
                                       placeholder="Doe">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address *</label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   required
                                   placeholder="john@example.com">
                            <div class="invalid-feedback" id="emailError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="username" class="form-label">Username *</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   required
                                   placeholder="johndoe"
                                   pattern="[a-zA-Z0-9_-]{3,30}">
                            <div class="form-text">3-30 characters, letters, numbers, hyphens and underscores only</div>
                            <div class="invalid-feedback" id="usernameError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="password" class="form-label">Password *</label>
                            <div class="input-group">
                                <input type="password" 
                                       class="form-control" 
                                       id="password" 
                                       name="password" 
                                       required
                                       placeholder="Create a strong password">
                                <button class="btn btn-outline-secondary" 
                                        type="button" 
                                        id="togglePassword">
                                    <i class="fas fa-eye" id="toggleIcon"></i>
                                </button>
                            </div>
                            
                            <!-- Password strength indicator -->
                            <div class="mt-2">
                                <div class="progress" style="height: 4px;">
                                    <div class="progress-bar" id="passwordStrength" style="width: 0%"></div>
                                </div>
                                <small class="form-text text-muted" id="passwordHelp">
                                    Password must be at least 12 characters with uppercase, lowercase, numbers, and special characters
                                </small>
                            </div>
                            <div class="invalid-feedback" id="passwordError"></div>
                        </div>

                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">Confirm Password *</label>
                            <input type="password" 
                                   class="form-control" 
                                   id="confirm_password" 
                                   name="confirm_password" 
                                   required
                                   placeholder="Confirm your password">
                            <div class="invalid-feedback" id="confirmPasswordError"></div>
                        </div>

                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="terms" name="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the <a href="#" target="_blank">Terms of Service</a> 
                                and <a href="#" target="_blank">Privacy Policy</a> *
                            </label>
                            <div class="invalid-feedback" id="termsError"></div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 mb-3" id="registerBtn">
                            <span class="spinner-border spinner-border-sm me-2 d-none" id="registerSpinner"></span>
                            Create Account
                        </button>
                    </form>

                    <div class="text-center">
                        <p class="mb-0">
                            Already have an account? 
                            <a href="{{ url_for('login') }}" class="text-decoration-none fw-bold">Sign in</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right side - Benefits -->
        <div class="col-md-6 d-flex align-items-center justify-content-center bg-success text-white">
            <div class="text-center p-5">
                <div class="mb-4">
                    <i class="fas fa-user-plus fa-5x mb-3 opacity-75"></i>
                </div>
                <h1 class="display-4 fw-bold mb-4">Start Your Investment Journey</h1>
                <p class="lead mb-4">
                    Get access to professional-grade investment tools and AI-powered analysis
                    to make informed investment decisions.
                </p>
                
                <div class="row text-start">
                    <div class="col-12 mb-3">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fas fa-robot fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">AI-Powered Analysis</h5>
                                <p class="mb-0">Advanced algorithms analyze market trends, news sentiment, and technical indicators</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12 mb-3">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fas fa-leaf fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">ESG Screening</h5>
                                <p class="mb-0">Invest responsibly with built-in environmental and social governance filters</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12 mb-3">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fas fa-chart-bar fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">Portfolio Tracking</h5>
                                <p class="mb-0">Monitor your investments with real-time updates and performance analytics</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="d-flex align-items-start">
                            <div class="me-3">
                                <i class="fas fa-shield-alt fa-2x"></i>
                            </div>
                            <div>
                                <h5 class="mb-1">Secure & Private</h5>
                                <p class="mb-0">Bank-grade security with encryption and comprehensive audit trails</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password visibility
    const togglePassword = document.getElementById('togglePassword');
    const password = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');

    togglePassword.addEventListener('click', function() {
        const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
        password.setAttribute('type', type);
        
        if (type === 'text') {
            toggleIcon.className = 'fas fa-eye-slash';
        } else {
            toggleIcon.className = 'fas fa-eye';
        }
    });

    // Password strength checker
    const passwordField = document.getElementById('password');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordHelp = document.getElementById('passwordHelp');

    function checkPasswordStrength(password) {
        let strength = 0;
        let feedback = [];

        if (password.length >= 12) strength += 20;
        else feedback.push('at least 12 characters');

        if (/[a-z]/.test(password)) strength += 20;
        else feedback.push('lowercase letters');

        if (/[A-Z]/.test(password)) strength += 20;
        else feedback.push('uppercase letters');

        if (/\d/.test(password)) strength += 20;
        else feedback.push('numbers');

        if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 20;
        else feedback.push('special characters');

        return { strength, feedback };
    }

    passwordField.addEventListener('input', function() {
        const result = checkPasswordStrength(this.value);
        
        passwordStrength.style.width = result.strength + '%';
        
        if (result.strength < 40) {
            passwordStrength.className = 'progress-bar bg-danger';
        } else if (result.strength < 80) {
            passwordStrength.className = 'progress-bar bg-warning';
        } else {
            passwordStrength.className = 'progress-bar bg-success';
        }

        if (result.feedback.length > 0) {
            passwordHelp.textContent = 'Password needs: ' + result.feedback.join(', ');
            passwordHelp.className = 'form-text text-danger';
        } else {
            passwordHelp.textContent = 'Strong password!';
            passwordHelp.className = 'form-text text-success';
        }
    });

    // Form validation
    const registerForm = document.getElementById('registerForm');
    const registerBtn = document.getElementById('registerBtn');
    const registerSpinner = document.getElementById('registerSpinner');

    registerForm.addEventListener('submit', function(e) {
        let isValid = true;

        // Reset validation states
        const inputs = ['email', 'username', 'password', 'confirm_password', 'terms'];
        inputs.forEach(id => {
            document.getElementById(id).classList.remove('is-invalid');
        });

        // Email validation
        const email = document.getElementById('email');
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email.value || !emailRegex.test(email.value)) {
            email.classList.add('is-invalid');
            document.getElementById('emailError').textContent = 'Please enter a valid email address';
            isValid = false;
        }

        // Username validation
        const username = document.getElementById('username');
        const usernameRegex = /^[a-zA-Z0-9_-]{3,30}$/;
        if (!username.value || !usernameRegex.test(username.value)) {
            username.classList.add('is-invalid');
            document.getElementById('usernameError').textContent = 'Username must be 3-30 characters, letters, numbers, hyphens and underscores only';
            isValid = false;
        }

        // Password validation
        const passwordResult = checkPasswordStrength(password.value);
        if (passwordResult.strength < 80) {
            password.classList.add('is-invalid');
            document.getElementById('passwordError').textContent = 'Password is too weak';
            isValid = false;
        }

        // Confirm password validation
        const confirmPassword = document.getElementById('confirm_password');
        if (confirmPassword.value !== password.value) {
            confirmPassword.classList.add('is-invalid');
            document.getElementById('confirmPasswordError').textContent = 'Passwords do not match';
            isValid = false;
        }

        // Terms validation
        const terms = document.getElementById('terms');
        if (!terms.checked) {
            terms.classList.add('is-invalid');
            document.getElementById('termsError').textContent = 'You must agree to the terms of service';
            isValid = false;
        }

        if (!isValid) {
            e.preventDefault();
            return false;
        }

        // Show loading state
        registerBtn.disabled = true;
        registerSpinner.classList.remove('d-none');
    });

    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        });
    }, 5000);
});
</script>
{% endblock %}